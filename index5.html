<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© | Ø§Ù„Ù†Ø§Ø¯ÙŠ</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* ------------------------------ */
    /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
    /* ------------------------------ */
    body { 
      font-family: "Tahoma", sans-serif; 
      background: #f0f2f5; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­ Ù„Ù„Ù…ÙˆÙ‚Ø¹ */
      margin: 0; 
      color: #333; /* Ù„ÙˆÙ† Ù†Øµ Ø¯Ø§ÙƒÙ† */
      display: flex;
      flex-direction: column;
      min-height: 100vh; /* ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„ØµÙØ­Ø© ØªØºØ·ÙŠ ÙƒØ§Ù…Ù„ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© */
    }

    /* ------------------------------ */
    /* ØµÙˆØ±Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© (Banner) */
    /* ------------------------------ */
    .hero-banner {
      width: 100%;
      height: 200px; /* ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙƒØ´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ */
      background-image: url('images/imag1.jpg'); /* Ø§ÙØªØ±Ø§Ø¶ Ø§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„ØµÙˆØ±Ø© .jpg */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }
    .hero-banner h1 {
        margin: 0;
        font-size: 2.5em;
    }

    /* ------------------------------ */
    /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
    /* ------------------------------ */
    .main-content {
        flex-grow: 1;
        padding: 20px;
        max-width: 1200px;
        width: 100%;
        margin: 0 auto;
    }

    .container { 
      background: white; 
      padding: 30px; 
      border-radius: 15px; 
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); 
      width: 100%;
      max-width: 600px;
      margin: 20px auto;
      text-align: center; 
    }

    button { 
      width: 100%; 
      padding: 12px; 
      margin-top: 12px; 
      border-radius: 8px; 
      border: none; 
      font-weight: bold; 
      background: #007bff; /* Ù„ÙˆÙ† Ø£Ø³Ø§Ø³ÙŠ Ø¹ØµØ±ÙŠ */
      color: white; 
      cursor: pointer; 
      transition: background 0.3s, transform 0.3s; 
    }
    button:hover { 
      background: #0056b3; 
      transform: scale(1.01); 
    }

    /* ------------------------------ */
    /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ (Navigation Bar) - Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© */
    /* ------------------------------ */
    .nav-bar {
      position: sticky; /* ÙŠØ«Ø¨Øª Ø§Ù„Ø´Ø±ÙŠØ· ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
      bottom: 0;
      width: 100%;
      background: #333; /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© */
      color: white;
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: white;
      font-size: 0.8em;
      transition: color 0.3s;
      cursor: pointer;
    }
    .nav-item:hover {
        color: #007bff;
    }
    .nav-icon {
      font-size: 1.5em; /* Ø­Ø¬Ù… ÙƒØ¨ÙŠØ± Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©/Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */
      margin-bottom: 4px;
      line-height: 1; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø© Ø­ÙˆÙ„ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */
    }

    /* ------------------------------ */
    /* ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ */
    /* ------------------------------ */
    .profile-avatar {
        width: 35px;
        height: 35px;
        border-radius: 50%; /* Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ø±ÙŠ */
        object-fit: cover;
        border: 2px solid white;
    }
    .nav-item.profile .nav-icon {
        border-radius: 50%;
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #ccc; /* Ù„ÙˆÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠ ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØµÙˆØ±Ø© */
        font-size: 0.9em;
    }
  </style>
</head>
<body>
  
  <div class="hero-banner">
      <h1>ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù†Ø§Ø¯ÙŠ!</h1>
  </div>

  <div class="main-content">
      <div class="container">
          <h2 id="welcome">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h2> 

          <button id="adminBtn" style="display:none;" onclick="goToAdmin()">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
          
          <button onclick="goToMembers()">Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù†Ø§Ø¯ÙŠ</button>
          <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
      </div>

      <div style="margin-top: 30px; text-align: center;">
          <p>Ø§ÙƒØªØ´Ù Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«Ø§Øª ÙˆØ£Ù†Ø´Ø·Ø© Ø§Ù„Ù†Ø§Ø¯ÙŠ Ù‡Ù†Ø§...</p>
      </div>
  </div>

  <div class="nav-bar">
      <a href="#" class="nav-item">
          <span class="nav-icon">ğŸ </span>
          <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
      </a>

      <a href="#" class="nav-item">
          <span class="nav-icon">ğŸ’¬</span>
          <span>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</span>
      </a>

      <a href="#" class="nav-item">
          <span class="nav-icon">ğŸ§­</span>
          <span>Ø§Ù„ØªØµÙØ­</span>
      </a>

      <a href="#" class="nav-item">
          <span class="nav-icon">ğŸ“š</span>
          <span>Ø§Ù„Ù…ÙƒØªØ¨Ø©</span>
      </a>

      <a href="#" class="nav-item profile" id="profileNav">
          <span class="nav-icon">
             <img id="avatarImage" class="profile-avatar" src="images/imag2.png" alt="Ø§Ù„ØµÙˆØ±Ø©">
          </span>
          <span>Ø¨Ø±ÙˆÙØ§ÙŠÙ„ÙŠ</span>
      </a>
  </div>


  <script>
    const supabaseUrl = "https://dxpqkojigblqgwqxwbmg.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR4cHFrb2ppZ2JscWd3cXh3Ym1nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2OTUyMTEsImV4cCI6MjA3NDI3MTIxMX0.KVfAmSbRS1-FIEaX7C_n-GQ-MyaSGa7goKFO9wRtxkg";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    async function loadUser(){
      try {
        const { data: userData, error: userError } = await supabase.auth.getUser();

        if(userError || !userData.user){
          console.log("No user session, redirecting...");
          window.location.href = "index.html";
          return;
        }

        const user = userData.user;

        // 1. Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù…Ù† Ø¬Ø¯ÙˆÙ„ 'profiles'
        const { data: profile, error: profileErr } = await supabase
          .from("profiles")
          .select("username, role")
          .eq("id", user.id)
          .single();

        if(profileErr && profileErr.code !== "PGRST116"){
          console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„:", profileErr.message);
          return;
        }

        const username = profile?.username || "Ù…Ø³ØªØ®Ø¯Ù…";
        document.getElementById("welcome").textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ ${username} ğŸ‘‹`;

        const role = profile?.role?.toLowerCase() || "";
        if(role === "admin" || role === "owner"){
          document.getElementById("adminBtn").style.display = "block";
        } else {
          document.getElementById("adminBtn").style.display = "none";
        }
        
        // 2. ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù…Ù† Ø§Ù„Ù€ user_metadata
        const avatarImage = document.getElementById("avatarImage");
        // Ù†ÙØªØ±Ø¶ Ø£Ù† Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ù…Ø®Ø²Ù‘Ù† ÙÙŠ Ø­Ù‚Ù„ avatar_url Ø¶Ù…Ù† user_metadata
        const avatarUrl = user.user_metadata?.avatar_url; 
        
        if (avatarUrl) {
           avatarImage.src = avatarUrl;
        } else {
           // ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØµÙˆØ±Ø© Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© imag2
           avatarImage.src = "images/imag2.png"; 
        }


      } catch(err){
        console.error("Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹:", err);
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: " + (err.message || err));
      }
    }

    async function logout(){
      try { await supabase.auth.signOut(); } catch(err){ console.warn(err); }
      window.location.href = "index.html";
    }

    function goToMembers(){ window.location.href = "index3.html"; }
    function goToAdmin(){ window.location.href = "index6.html"; }

    loadUser();
  </script>
</body>
</html>
