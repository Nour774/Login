<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manga Sanctum ğŸ“š</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@500;700&display=swap');

    :root {
      --bg-main: radial-gradient(circle at center, #111 40%, #000);
      --text-color: #eee;
      --accent: #a00;
      --shadow: #400;
      --highlight: #ffdddd;
      --card-bg: #181818;
    }

    body {
      margin: 0;
      font-family: 'Cairo', sans-serif;
      background: var(--bg-main);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      text-align: center;
      padding: 20px;
      text-shadow: 0 0 8px var(--accent);
    }

    h1 {
      font-size: 2rem;
      color: var(--highlight);
      margin: 0;
    }

    nav {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 10px 0 20px;
    }

    nav button {
      background: linear-gradient(90deg, #800, #b00);
      border: none;
      border-radius: 10px;
      color: #fff;
      padding: 8px 20px;
      font-size: 1rem;
      cursor: pointer;
      transition: 0.3s;
      box-shadow: 0 0 10px var(--shadow);
    }

    nav button.active, nav button:hover {
      background: linear-gradient(90deg, #b00, #e00);
      transform: scale(1.05);
    }

    .panel {
      display: none;
      width: 90%;
      max-width: 1000px;
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 0 20px var(--shadow);
      margin-bottom: 40px;
      min-height: 400px;
    }

    .panel.active {
      display: block;
      animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* --- Ø§Ù„Ù‚Ø§Ø±Ø¦ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…ØµØ§Ø¯Ø± --- */
    .manga-list, .chapter-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 16px;
    }

    .manga-card {
      background: #222;
      border-radius: 10px;
      overflow: hidden;
      text-align: center;
      box-shadow: 0 0 10px var(--shadow);
      cursor: pointer;
      transition: 0.25s;
    }

    .manga-card:hover {
      transform: scale(1.05);
    }

    .manga-card img {
      width: 100%;
      height: 210px;
      object-fit: cover;
    }

    .manga-card h3 {
      margin: 8px 0;
      font-size: 1rem;
      color: var(--highlight);
    }

    .chapter-item {
      background: #252525;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
    }

    .chapter-item:hover {
      background: #333;
      color: var(--highlight);
    }

    .loading, .error {
      text-align: center;
      color: var(--highlight);
      margin-top: 30px;
    }

    .error {
      color: #f55;
    }

    .back-btn {
      background: #600;
      color: white;
      padding: 8px 18px;
      border: none;
      border-radius: 8px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: 0.25s;
    }

    .back-btn:hover {
      background: #900;
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ“œ Manga Sanctum</h1>
  </header>

  <nav>
    <button class="tab-btn active" data-target="panelLibrary">ğŸ“š Ø§Ù„Ù…ÙƒØªØ¨Ø©</button>
    <button class="tab-btn" data-target="panelSources">ğŸ”— Ø§Ù„Ù…ØµØ§Ø¯Ø±</button>
    <button class="tab-btn" data-target="panelSettings">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
  </nav>

  <!-- ğŸ“˜ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…ÙƒØªØ¨Ø© -->
  <section id="panelLibrary" class="panel active">
    <p>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù…ÙƒØªØ¨Ø© Manga Sanctum! Ù‡Ù†Ø§ ØªØ¬Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆÙ…Ø´Ø§Ø±ÙŠØ¹Ùƒ.</p>
  </section>

  <!-- ğŸ”— ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…ØµØ§Ø¯Ø± (Ø§Ù„Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ) -->
  <section id="panelSources" class="panel">
    <div id="mangaSection">
      <div id="loadingManga" class="loading">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø§Ù†Ø¬Ø§Øª...</div>
      <div id="mangaList" class="manga-list"></div>
      <div id="errorManga" class="error"></div>
    </div>

    <div id="chaptersSection" style="display:none;">
      <button class="back-btn" id="backToManga">â† Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
      <div id="loadingChapters" class="loading">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØµÙˆÙ„...</div>
      <div id="chapterList" class="chapter-list"></div>
      <div id="errorChapters" class="error"></div>
    </div>
  </section>

  <!-- âš™ï¸ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
  <section id="panelSettings" class="panel">
    <p>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø³ØªÙØ¶Ø§Ù Ù‚Ø±ÙŠØ¨Ù‹Ø§.</p>
  </section>

  <script>
    // ğŸŒ Supabase Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„
    const SUPABASE_URL = "https://dxpqkojigblqgwqxwbmg.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR4cHFrb2ppZ2JscWd3cXh3Ym1nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2OTUyMTEsImV4cCI6MjA3NDI3MTIxMX0.KVfAmSbRS1-FIEaX7C_n-GQ-MyaSGa7goKFO9wRtxkg";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ğŸ” ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    const tabs = document.querySelectorAll(".tab-btn");
    const panels = document.querySelectorAll(".panel");
    tabs.forEach(btn => {
      btn.onclick = () => {
        tabs.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        panels.forEach(p => p.classList.remove("active"));
        document.getElementById(btn.dataset.target).classList.add("active");
      };
    });

    // ğŸ§­ Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù‚Ø§Ø±Ø¦
    const mangaList = document.getElementById("mangaList");
    const loadingManga = document.getElementById("loadingManga");
    const errorManga = document.getElementById("errorManga");
    const chaptersSection = document.getElementById("chaptersSection");
    const mangaSection = document.getElementById("mangaSection");
    const loadingChapters = document.getElementById("loadingChapters");
    const chapterList = document.getElementById("chapterList");
    const errorChapters = document.getElementById("errorChapters");
    const backToManga = document.getElementById("backToManga");

    // ğŸ§¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø§Ù†Ø¬Ø§Øª
    async function loadMangaList() {
      const { data, error } = await supabase.from("manga").select("id, title, cover_url");
      loadingManga.style.display = "none";

      if (error) {
        errorManga.textContent = "ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø§Ù†Ø¬Ø§Øª.";
        console.error(error);
        return;
      }

      data.forEach(m => {
        const card = document.createElement("div");
        card.className = "manga-card";
        card.innerHTML = `<img src="${m.cover_url}" alt="${m.title}"><h3>${m.title}</h3>`;
        card.onclick = () => loadChapters(m.id, m.title);
        mangaList.appendChild(card);
      });
    }

    // ğŸ“– ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØµÙˆÙ„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù…Ø§Ù†Ø¬Ø§ Ù…Ø¹ÙŠÙ†Ø©
    async function loadChapters(mangaId, title) {
      mangaSection.style.display = "none";
      chaptersSection.style.display = "block";
      chapterList.innerHTML = "";
      loadingChapters.style.display = "block";
      errorChapters.textContent = "";

      const { data, error } = await supabase
        .from("chapters")
        .select("id, title, number")
        .eq("manga_id", mangaId)
        .order("number", { ascending: true });

      loadingChapters.style.display = "none";

      if (error) {
        errorChapters.textContent = "ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØµÙˆÙ„.";
        console.error(error);
        return;
      }

      localStorage.setItem("chapters", JSON.stringify(data));

      data.forEach(ch => {
        const div = document.createElement("div");
        div.className = "chapter-item";
        div.textContent = `Ø§Ù„ÙØµÙ„ ${ch.number}: ${ch.title}`;
        div.onclick = () => {
          window.location.href = `index8.html?chapter_id=${ch.id}`;
        };
        chapterList.appendChild(div);
      });
    }

    backToManga.onclick = () => {
      chaptersSection.style.display = "none";
      mangaSection.style.display = "block";
    };

    loadMangaList();
  </script>
</body>
</html>
